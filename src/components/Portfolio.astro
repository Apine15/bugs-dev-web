---
const projects = [
  {
    id: "topografia",
    title: "Nivelación Topográfica Desktop",
    shortDescription: "Software de ingeniería para cálculo y graficado de terrenos offline.",
    fullDescription: "Desarrollamos una herramienta de escritorio capaz de procesar datos topográficos complejos sin conexión a internet. Permite a los ingenieros generar curvas de nivel en tiempo real directamente en el campo, reduciendo el tiempo de gabinete en un 70%.",
    gallery: [
        { type: 'image', src: "/images/projects/img-2-inta.webp" },
        { type: 'image', src: "/images/projects/img-3-inta.webp" },
        { type: 'image', src: "/images/projects/img-4-inta.webp" },
    ],
    tags: ["Python", "PyQt6", "Matplotlib", "Pandas"],
    category: "Desktop App"
  },
  {
    id: "educativa",
    title: "Plataforma Educativa Integral",
    shortDescription: "CMS autoadministrable con despliegue personalizado en VPS.",
    fullDescription: "Migramos y modernizamos la infraestructura digital de un instituto educativo. Configuramos un servidor VPS Linux desde cero, asegurando la base de datos y optimizando Nginx para soportar cientos de alumnos concurrentes.",
    // Galería: VIDEO + IMAGEN
    gallery: [
        // rutas para videos o imágenes
        { type: 'video', src: "/videos/iaf.mp4" }, 
        // { type: 'image', src: "https://placehold.co/600x400/2E294E/D7263D?text=Panel+Admin" }
    ],
    tags: ["Django", "Ubuntu VPS", "Nginx", "PostgreSQL"],
    category: "Web Platform"
  }
];
---

<section id="portfolio" class="py-20 px-6 md:px-12">
  <div class="max-w-6xl mx-auto">
    
    <h2 class="text-3xl md:text-5xl font-bold mb-12 text-center">
      Proyectos <span class="text-brand-lime">Destacados</span>
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {projects.map((project) => (
        <article class="bg-brand-bg border border-white/10 rounded-2xl overflow-hidden hover:border-brand-lime transition-all duration-300 group flex flex-col h-full shadow-lg hover:shadow-brand-lime/10">
          
          <div class="h-56 bg-gray-800 relative overflow-hidden group-hover:opacity-90 transition-opacity">
             {project.gallery[0].type === 'video' ? (
                // Si primero es un video, se muestras un video mudo en loop o una imagen placeholder
                <video src={project.gallery[0].src} class="w-full h-full object-cover" muted loop playsinline autoplay></video>
             ) : (
                <img src={project.gallery[0].src} alt={project.title} class="w-full h-full object-cover" />
             )}
             
             <div class="absolute top-4 right-4 bg-black/70 px-3 py-1 rounded-full text-xs font-bold text-white uppercase tracking-wider backdrop-blur-md border border-white/10">
                {project.category}
             </div>
          </div>

          <div class="p-8 flex flex-col flex-grow">
            <h3 class="text-2xl font-bold mb-3">{project.title}</h3>
            <p class="opacity-70 mb-6 flex-grow">{project.shortDescription}</p>
            
            <button 
              data-target={project.id}
              class="open-modal text-brand-crimson font-bold hover:text-white transition-colors flex items-center gap-2 mt-auto self-start cursor-pointer"
            >
              Ver caso de estudio 
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
            </button>
          </div>

        </article>
      ))}
    </div>

  </div>

  {projects.map((project) => (
    <dialog id={project.id} class="bg-transparent p-0 w-full max-w-5xl backdrop:bg-black/90 m-auto shadow-2xl rounded-2xl">
      <div class="bg-brand-bg border border-brand-lime/30 text-brand-text overflow-hidden flex flex-col md:flex-row relative h-[85vh] md:h-[80vh]">
        
        <form method="dialog" class="absolute top-4 right-4 z-20">
            <button class="p-2 bg-black/60 rounded-full hover:bg-brand-crimson transition-colors text-white cursor-pointer backdrop-blur-sm border border-white/10">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </form>

        <div class="w-full md:w-3/5 bg-black/20 flex flex-col gap-4 p-4 md:p-8 overflow-y-auto border-b md:border-b-0 md:border-r border-white/10">
            {project.gallery.map((item) => (
                <div class="rounded-xl overflow-hidden border border-white/5 shadow-lg shrink-0">
                    {item.type === 'video' ? (
                        <video 
                            src={item.src} 
                            controls 
                            class="w-full h-auto"
                            poster={project.gallery[1]?.type === 'image' ? project.gallery[1].src : ''} 
                        >
                            Tu navegador no soporta videos.
                        </video>
                    ) : (
                        <img src={item.src} alt="Galería proyecto" class="w-full h-auto object-cover" />
                    )}
                </div>
            ))}
        </div>

        <div class="w-full md:w-2/5 p-8 md:p-10 space-y-8 overflow-y-auto bg-brand-bg">
            <div>
                <h3 class="text-3xl md:text-4xl font-bold text-brand-lime mb-2">{project.title}</h3>
                <span class="inline-block px-3 py-1 rounded-full bg-brand-lime/10 text-brand-lime text-xs font-bold border border-brand-lime/20 uppercase tracking-wider">
                    {project.category}
                </span>
            </div>
            
            <div>
                <h4 class="text-sm font-bold uppercase tracking-wider opacity-60 mb-3 border-b border-white/10 pb-2">El Desafío & Solución</h4>
                <p class="opacity-90 leading-relaxed text-lg font-light">
                    {project.fullDescription}
                </p>
            </div>

            <div>
                <h4 class="text-sm font-bold uppercase tracking-wider opacity-60 mb-3 border-b border-white/10 pb-2">Tecnologías</h4>
                <div class="flex flex-wrap gap-2">
                    {project.tags.map(tag => (
                        <span class="px-3 py-1.5 text-sm font-mono rounded-md bg-white/5 border border-white/10 text-brand-lime hover:bg-brand-lime/10 transition-colors">
                            {tag}
                        </span>
                    ))}
                </div>
            </div>
        </div>

      </div>
    </dialog>
  ))}

</section>

<script>
  // Lógica del Modal
  const openButtons = document.querySelectorAll('.open-modal');
  const dialogs = document.querySelectorAll('dialog');

  openButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const modalId = btn.getAttribute('data-target');
      if (modalId) {
        const modal = document.getElementById(modalId) as HTMLDialogElement;
        if (modal) {
          modal.showModal();
          document.body.style.overflow = 'hidden'; 
        }
      }
    });
  });

  dialogs.forEach(dialog => {
      dialog.addEventListener('close', () => {
          document.body.style.overflow = '';
          // Opcional: Pausar videos al cerrar
          const videos = dialog.querySelectorAll('video');
          videos.forEach(v => v.pause());
      });
      
      dialog.addEventListener('click', (e) => {
          const rect = dialog.getBoundingClientRect();
          const isInDialog = (rect.top <= e.clientY && e.clientY <= rect.top + rect.height &&
            rect.left <= e.clientX && e.clientX <= rect.left + rect.width);
          if (!isInDialog) {
              dialog.close();
          }
      });
  });
</script>